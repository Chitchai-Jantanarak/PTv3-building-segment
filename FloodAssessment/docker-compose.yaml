version: '3.8'

services:
  flood-assessment:
    build:
      context: .
      dockerfile: Dockerfile
    image: flood-assessment:latest
    container_name: flood_assessment_dev
    runtime: nvidia
    ipc: host # Recommended for PyTorch DataLoader
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - PYTHONPATH=/workspace/PointTransformerV3:/workspace/FloodAssessment:/workspace
    volumes:
      # Mount the parent directory to access both FloodAssessment and PointTransformerV3
      - ../:/workspace
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    command: /bin/bash
    tty: true
